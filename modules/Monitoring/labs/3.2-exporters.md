# Lab: Exporters for Application Metrics

## Overview

Not all applications support metrics natively. In these cases, we use **exporters**â€”sidecar or standalone processes that expose metrics in a format Prometheus can scrape. Exporters bridge the gap, but add operational overhead, so it's best if your app can emit metrics directly.

---

## Part 1: Why Use Exporters?

- Some apps (like MySQL, Redis, Nginx) don't expose Prometheus metrics out of the box.
- Exporters connect to the app, collect stats, and expose them at `/metrics`.
- Example: The **MySQL exporter** queries MySQL internals and exposes them for Prometheus.
- Exporters are another system to deploy, monitor, and keep up-to-date.

**Best practice:** Prefer native metrics when possible. Use exporters only when necessary.

---

## Part 2: Inspect the MySQL Exporter

Your lab environment already includes a MySQL database and a MySQL exporter.

1. Review the Docker image used:
	- Image: `prom/mysqld-exporter:v0.15.1`
	- DockerHub: [https://hub.docker.com/r/prom/mysqld-exporter](https://hub.docker.com/r/prom/mysqld-exporter)
	- GitHub: [https://github.com/prometheus/mysqld_exporter](https://github.com/prometheus/mysqld_exporter)
2. Explore the documentation for supported flags, environment variables, and metrics.

---

## Part 3: Test the Exporter Endpoint

Let's verify the exporter is working and exposing metrics.

1. Find the name of the exporter pod:
	```bash
	kubectl get pods -n monitoring -l app=mysql-exporter
	```
2. Run a temporary test pod using netshoot:
	```bash
	kubectl run --rm -i -t netshoot --image=nicolaka/netshoot --namespace monitoring -- bash
	```
3. Inside the netshoot pod, curl the exporter:
	```bash
	# Replace <exporter-pod> with the actual pod name
	curl http://<exporter-pod>:9104/metrics
	```
	You should see Prometheus-formatted metrics output.

---

## Part 4: What is a ServiceMonitor?

Prometheus Operator uses the **ServiceMonitor** Custom Resource Definition (CRD) to discover and scrape metrics endpoints in Kubernetes.

- A ServiceMonitor selects a Service (by label) and tells Prometheus how to scrape it.
- You define ServiceMonitors in YAML, specifying endpoints, intervals, and selectors.
- This makes metrics collection declarative and GitOps-friendly.

**Example ServiceMonitor:**
```yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: mysql-exporter
  namespace: monitoring
spec:
  selector:
	 matchLabels:
		app: mysql-exporter
  endpoints:
  - port: metrics
	 interval: 30s
```

---

## Summary

- Exporters help monitor apps that lack native metrics.
- MySQL exporter exposes database stats for Prometheus.
- You tested the exporter endpoint using netshoot.
- ServiceMonitor CRDs make scraping endpoints easy and declarative in Kubernetes.

---

## Challenge

- Explore other exporters (Redis, Nginx, Node Exporter) and try scraping their metrics!
